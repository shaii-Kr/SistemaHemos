<!doctype html>
<html lang="pt-br">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Calendar">
    <meta name="author" content="Charles Anderson">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/style2.css">
    <title>HEMOS - Login</title>
    <link rel="icon" href="../Imagens/icone.ico">
</head>

<body style="background-color: #f7f3e9">
    <!-- Cabeçalho -->

    <header style="font-size: 20px;">
        <nav class="navbar navbar-expand-md navbar-light custom" style="background-color: #5eaaa8;">
            <a class="navbar-brand" href="index.html"><img src="../Imagens/HEMOS_logo_branca_transparente.png"
                    width="160"></a>

            <div class="dropdown" style="font-size: 15px;">
                <a class="dropbtn"><img src="../Imagens/Login_icon.png" width="40" height="40"
                        style="margin-top: -10%; margin-bottom: -5%; margin-left: 60%;"></a>
                <div class="dropdown-content">
                    <a href="LoginUser.html">Login Usuário</a>
                    <a href="PerfilUser.html"id="link_listar_infoDoador">Perfil Usuário</a>
                    <a href="LoginFunc.html">Login Funcionário</a>
                    <a href="PerfilFunc.html" id="link_listar_infoFuncionario">Perfil Funcionário</a>
                </div>
            </div>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent" style="margin-left: 3%;">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html" style="color: white;"><b>Home</b><span
                                class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item" style="margin-left: 20px;">
                        <a class="nav-link" href="Sobre.html" style="color: white;">Sobre</a>
                    </li>
                    <li class="nav-item" style="margin-left: 20px;">
                        <a class="nav-link" href="Agendamento.html" style="color: white;">Agendamento</a>
                    </li>
                    <!-- Dropdown Cadastro-->
                    <li class="nav-item" style="margin-left: 20px;">
                        <div class="dropdown">
                        <a class="dropbtn">Cadastre-se</a>
                        <div class="dropdown-content">
                            <a href="CadastroDoador.html">Doador</a>
                            <a href="CadastroFunc.html">Funcionário</a>
                        </div>
                        </div>
                    </li>
                    <li class="nav-item" style="margin-left: 20px;">
                        <a class="nav-link" href="Contatos.html" style="color: white;">Contatos</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="content" style="margin-top: 150px;">
        <div class="calendar-container">
            <div class="calendar">
                <div class="year-header">
                    <span class="left-button" id="prev"> &lang; </span>
                    <span class="year" id="label"></span>
                    <span class="right-button" id="next"> &rang; </span>
                </div>
                <table class="months-table">
                    <tbody>
                        <tr class="months-row">
                            <td class="month">Jan</td>
                            <td class="month">Fev</td>
                            <td class="month">Mar</td>
                            <td class="month">Abr</td>
                            <td class="month">Mai</td>
                            <td class="month">Jun</td>
                            <td class="month">Jul</td>
                            <td class="month">Ago</td>
                            <td class="month">Set</td>
                            <td class="month">Out</td>
                            <td class="month">Nov</td>
                            <td class="month">Dez</td>
                        </tr>
                    </tbody>
                </table>

                <table class="days-table">
                    <td class="day">Seg</td>
                    <td class="day">Ter</td>
                    <td class="day">Qua</td>
                    <td class="day">Qui</td>
                    <td class="day">Sex</td>
                    <td class="day">Sáb</td>
                    <td class="day">Dom</td>
                </table>
                <div class="frame">
                    <table class="dates-table">
                        <tbody class="tbody">
                        </tbody>
                    </table>
                </div>
                <button class="button" id="add-button">Agendar</button>
            </div>
        </div>
        <div class="events-container">
        </div>
        <div class="dialog" id="dialog">
            <h2 class="dialog-header" style="margin-top: 70px;"> Agendamento </h2>
            <form class="form" id="form">
                <div class="form-container" align=center style="margin-top:60px;">
                    <label class="form-label" id="valueFromMyButton" for="name">Hemocentro</label>
                    <input class="input" type="text" id="name" maxlength="36">
                    <label class="form-label" id="valueFromMyButton" for="count">Horário</label>
                    <input class="input" type="time" id="count" min="0" max="1000000" maxlength="7">
                    <input type="button" value="Cancelar" class="button" id="cancel-button">
                    <input type="button" value="Salvar" class="button" id="ok-button">
                </div>
            </form>
        </div>
    </div>
    <!-- Dialog Box-->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous">
        </script>
    <script src="app.js"></script>
    <script>// Setup the calendar with the current date
        $(document).ready(function () {
            var date = new Date();
            var today = date.getDate();
            // Set click handlers for DOM elements
            $(".right-button").click({ date: date }, next_year);
            $(".left-button").click({ date: date }, prev_year);
            $(".month").click({ date: date }, month_click);
            $("#add-button").click({ date: date }, new_event);
            // Set current month as active
            $(".months-row").children().eq(date.getMonth()).addClass("active-month");
            init_calendar(date);
            var events = check_events(today, date.getMonth() + 1, date.getFullYear());
            show_events(events, months[date.getMonth()], today);
        });

        // Initialize the calendar by appending the HTML dates
        function init_calendar(date) {
            $(".tbody").empty();
            $(".events-container").empty();
            var calendar_days = $(".tbody");
            var month = date.getMonth();
            var year = date.getFullYear();
            var day_count = days_in_month(month, year);
            var row = $("<tr class='table-row'></tr>");
            var today = date.getDate();
            // Set date to 1 to find the first day of the month
            date.setDate(1);
            var first_day = date.getDay();
            // 35+firstDay is the number of date elements to be added to the dates table
            // 35 is from (7 days in a week) * (up to 5 rows of dates in a month)
            for (var i = 0; i < 35 + first_day; i++) {
                // Since some of the elements will be blank, 
                // need to calculate actual date from index
                var day = i - first_day + 1;
                // If it is a sunday, make a new row
                if (i % 7 === 0) {
                    calendar_days.append(row);
                    row = $("<tr class='table-row'></tr>");
                }
                // if current index isn't a day in this month, make it blank
                if (i < first_day || day > day_count) {
                    var curr_date = $("<td class='table-date nil'>" + "</td>");
                    row.append(curr_date);
                }
                else {
                    var curr_date = $("<td class='table-date'>" + day + "</td>");
                    var events = check_events(day, month + 1, year);
                    if (today === day && $(".active-date").length === 0) {
                        curr_date.addClass("active-date");
                        show_events(events, months[month], day);
                    }
                    // If this date has any events, style it with .event-date
                    if (events.length !== 0) {
                        curr_date.addClass("event-date");
                    }
                    // Set onClick handler for clicking a date
                    curr_date.click({ events: events, month: months[month], day: day }, date_click);
                    row.append(curr_date);
                }
            }
            // Append the last row and set the current year
            calendar_days.append(row);
            $(".year").text(year);
        }

        // Get the number of days in a given month/year
        function days_in_month(month, year) {
            var monthStart = new Date(year, month, 1);
            var monthEnd = new Date(year, month + 1, 1);
            return (monthEnd - monthStart) / (1000 * 60 * 60 * 24);
        }

        // Event handler for when a date is clicked
        function date_click(event) {
            $(".events-container").show(250);
            $("#dialog").hide(250);
            $(".active-date").removeClass("active-date");
            $(this).addClass("active-date");
            show_events(event.data.events, event.data.month, event.data.day);
        };

        // Event handler for when a month is clicked
        function month_click(event) {
            $(".events-container").show(250);
            $("#dialog").hide(250);
            var date = event.data.date;
            $(".active-month").removeClass("active-month");
            $(this).addClass("active-month");
            var new_month = $(".month").index(this);
            date.setMonth(new_month);
            init_calendar(date);
        }

        // Event handler for when the year right-button is clicked
        function next_year(event) {
            $("#dialog").hide(250);
            var date = event.data.date;
            var new_year = date.getFullYear() + 1;
            $("year").html(new_year);
            date.setFullYear(new_year);
            init_calendar(date);
        }

        // Event handler for when the year left-button is clicked
        function prev_year(event) {
            $("#dialog").hide(250);
            var date = event.data.date;
            var new_year = date.getFullYear() - 1;
            $("year").html(new_year);
            date.setFullYear(new_year);
            init_calendar(date);
        }

        // Event handler for clicking the new event button
        function new_event(event) {
            // if a date isn't selected then do nothing
            if ($(".active-date").length === 0)
                return;
            // remove red error input on click
            $("input").click(function () {
                $(this).removeClass("error-input");
            })
            // empty inputs and hide events
            $("#dialog input[type=text]").val('');
            $("#dialog input[type=number]").val('');
            $(".events-container").hide(250);
            $("#dialog").show(250);
            // Event handler for cancel button
            $("#cancel-button").click(function () {
                $("#name").removeClass("error-input");
                $("#count").removeClass("error-input");
                $("#dialog").hide(250);
                $(".events-container").show(250);
            });
            // Event handler for ok button
            $("#ok-button").unbind().click({ date: event.data.date }, function () {
                var date = event.data.date;
                var name = $("#name").val().trim();
                var count = parseInt($("#count").val().trim());
                var day = parseInt($(".active-date").html());
                // Basic form validation
                if (name.length === 0) {
                    $("#name").addClass("error-input");
                }
                else if (isNaN(count)) {
                    $("#count").addClass("error-input");
                }
                else {
                    $("#dialog").hide(250);
                    console.log("new event");
                    new_event_json(name, count, date, day);
                    date.setDate(day);
                    init_calendar(date);
                }
            });
        }

        // Adds a json event to event_data
        function new_event_json(name, count, date, day) {
            var event = {
                "occasion": name,
                "invited_count": count,
                "year": date.getFullYear(),
                "month": date.getMonth() + 1,
                "day": day
            };
            event_data["events"].push(event);
        }

        // Display all events of the selected date in card views
        function show_events(events, month, day) {
            // Clear the dates container
            $(".events-container").empty();
            $(".events-container").show(250);
            console.log(event_data["events"]);
            // If there are no events for this date, notify the user
            if (events.length === 0) {
                var event_card = $("<div class='event-card'></div>");
                var event_name = $("<div class='event-name'>Não há nada agendado neste dia.</div>");
                $(event_card).css({ "border-left": "10px solid #FF1744" });
                $(event_card).append(event_name);
                $(".events-container").append(event_card);
            }
            else {
                // Go through and add each event as a card to the events container
                for (var i = 0; i < events.length; i++) {
                    var event_card = $("<div class='event-card'></div>");
                    var event_name = $("<div class='event-name'>" + events[i]["occasion"] + ":</div>");
                    var event_count = $("<div class='event-count'>" + events[i]["invited_count"] + " Invited</div>");
                    if (events[i]["cancelled"] === true) {
                        $(event_card).css({
                            "border-left": "10px solid #FF1744"
                        });
                        event_count = $("<div class='event-cancelled'>Cancelled</div>");
                    }
                    $(event_card).append(event_name).append(event_count);
                    $(".events-container").append(event_card);
                }
            }
        }

        // Checks if a specific date has any events
        function check_events(day, month, year) {
            var events = [];
            for (var i = 0; i < event_data["events"].length; i++) {
                var event = event_data["events"][i];
                if (event["day"] === day &&
                    event["month"] === month &&
                    event["year"] === year) {
                    events.push(event);
                }
            }
            return events;
        }

        // Given data for events in JSON format
        var event_data = {
            "events": [
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10,
                    "cancelled": true
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10,
                    "cancelled": true
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10,
                    "cancelled": true
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10,
                    "cancelled": true
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10,
                    "cancelled": true
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10,
                    "cancelled": true
                },
                {
                    "occasion": " Repeated Test Event ",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 10
                },
                {
                    "occasion": " Test Event",
                    "invited_count": 120,
                    "year": 2017,
                    "month": 5,
                    "day": 11
                }
            ]
        };

        const months = [
            "Janeiro",
            "Fevereiro",
            "Março",
            "Abril",
            "Maio",
            "Junho",
            "Julho",
            "Augosto",
            "Setembro",
            "Outubro",
            "Novembro",
            "Dezembro"
        ];</script>
</body>

</html>

</body>

</html>